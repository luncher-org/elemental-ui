(("undefined"!==typeof self?self:this)["webpackJsonpelemental_1_0_0"]=("undefined"!==typeof self?self:this)["webpackJsonpelemental_1_0_0"]||[]).push([[8],{7321:function(e,t,a){var s=a("ae6f");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("336321b8",s,!0,{sourceMap:!1,shadowMode:!1})},a812:function(e,t,a){"use strict";a("7321")},ae6f:function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,'.clearfix[data-v-3d113ddb]:after,.clearfix[data-v-3d113ddb]:before{content:" ";display:table}.clearfix[data-v-3d113ddb]:after{clear:both}.list-unstyled[data-v-3d113ddb]{margin:0;padding:0;list-style-type:none}.no-select[data-v-3d113ddb]{-webkit-user-select:none;-moz-user-select:none;user-select:none}.no-resize[data-v-3d113ddb]{resize:none}.hand[data-v-3d113ddb]{cursor:pointer;cursor:hand}.fixed[data-v-3d113ddb]{table-layout:fixed}.clip[data-v-3d113ddb]{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.clip[data-v-3d113ddb],.force-wrap[data-v-3d113ddb]{word-wrap:break-word}.force-wrap[data-v-3d113ddb]{white-space:normal}.bordered-section[data-v-3d113ddb]{border-bottom:1px solid var(--border);margin-bottom:20px;padding-bottom:20px}.section-divider[data-v-3d113ddb]{margin-bottom:20px;margin-top:20px}[data-v-3d113ddb] .yaml-editor{flex:1;min-height:200px}[data-v-3d113ddb] .yaml-editor .code-mirror .CodeMirror{position:static;height:auto;min-height:200px}',""]),e.exports=t},c8a0:function(e,t,a){"use strict";a.r(t),a.d(t,"isReady",(function(){return L}));var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.$fetchState.pending?a("Loading",{attrs:{delayed:!0}}):a("div",[a("div",{staticClass:"row mt-20"},[a("div",{staticClass:"col span-6"},[a("UnitInput",{directives:[{name:"int-number",rawName:"v-int-number"}],attrs:{"label-key":"cluster.credential.harvester.cpu",suffix:"C","output-as":"string",required:"",mode:e.mode,disabled:e.disabled,placeholder:e.t("cluster.harvester.machinePool.cpu.placeholder")},model:{value:e.value.cpuCount,callback:function(t){e.$set(e.value,"cpuCount",t)},expression:"value.cpuCount"}})],1),a("div",{staticClass:"col span-6"},[a("UnitInput",{directives:[{name:"int-number",rawName:"v-int-number"}],attrs:{"label-key":"cluster.credential.harvester.memory","output-as":"string",suffix:"GiB",mode:e.mode,disabled:e.disabled,required:"",placeholder:e.t("cluster.harvester.machinePool.memory.placeholder")},model:{value:e.value.memorySize,callback:function(t){e.$set(e.value,"memorySize",t)},expression:"value.memorySize"}})],1)]),a("div",{staticClass:"row mt-20"},[a("div",{staticClass:"col span-6"},[a("UnitInput",{directives:[{name:"int-number",rawName:"v-int-number"}],attrs:{"label-key":"cluster.credential.harvester.disk","output-as":"string",suffix:"GiB",mode:e.mode,disabled:e.disabled,required:"",placeholder:e.t("cluster.harvester.machinePool.disk.placeholder")},model:{value:e.value.diskSize,callback:function(t){e.$set(e.value,"diskSize",t)},expression:"value.diskSize"}})],1),a("div",{staticClass:"col span-6"},[e.isImportCluster?a("LabeledSelect",{attrs:{mode:e.mode,options:e.namespaceOptions,searchable:!0,required:!0,disabled:e.namespaceDisabled,"label-key":"cluster.credential.harvester.namespace",placeholder:e.t("cluster.harvester.machinePool.namespace.placeholder")},model:{value:e.value.vmNamespace,callback:function(t){e.$set(e.value,"vmNamespace",t)},expression:"value.vmNamespace"}}):a("LabeledInput",{attrs:{"label-key":"cluster.credential.harvester.namespace",required:!0,mode:e.mode,disabled:e.namespaceDisabled,placeholder:e.t("cluster.harvester.machinePool.namespace.placeholder")},model:{value:e.value.vmNamespace,callback:function(t){e.$set(e.value,"vmNamespace",t)},expression:"value.vmNamespace"}})],1)]),e.isImportCluster?a("div",{staticClass:"row mt-20"},[a("div",{staticClass:"col span-6"},[a("LabeledSelect",{attrs:{mode:e.mode,options:e.imageOptions,required:!0,searchable:!0,disabled:e.disabled,"label-key":"cluster.credential.harvester.image",placeholder:e.t("cluster.harvester.machinePool.image.placeholder")},on:{"on-open":e.onOpen},model:{value:e.value.imageName,callback:function(t){e.$set(e.value,"imageName",t)},expression:"value.imageName"}})],1),a("div",{staticClass:"col span-6"},[a("LabeledSelect",{attrs:{mode:e.mode,options:e.networkOptions,required:!0,disabled:e.disabledEdit,"label-key":"cluster.credential.harvester.network",placeholder:e.t("cluster.harvester.machinePool.network.placeholder")},model:{value:e.value.networkName,callback:function(t){e.$set(e.value,"networkName",t)},expression:"value.networkName"}})],1)]):a("div",{staticClass:"row mt-20"},[a("div",{staticClass:"col span-6"},[a("LabeledInput",{attrs:{mode:e.mode,required:!0,placeholder:e.t("cluster.credential.harvester.placeholder"),disabled:e.disabledEdit,"label-key":"cluster.credential.harvester.image"},model:{value:e.value.imageName,callback:function(t){e.$set(e.value,"imageName",t)},expression:"value.imageName"}})],1),a("div",{staticClass:"col span-6"},[a("LabeledInput",{attrs:{mode:e.mode,required:!0,placeholder:e.t("cluster.credential.harvester.placeholder"),disabled:e.disabledEdit,"label-key":"cluster.credential.harvester.network"},model:{value:e.value.networkName,callback:function(t){e.$set(e.value,"networkName",t)},expression:"value.networkName"}})],1)]),a("div",{staticClass:"row mt-20"},[a("div",{staticClass:"col span-6"},[a("LabeledInput",{attrs:{"label-key":"cluster.credential.harvester.sshUser",required:!0,mode:e.mode,disabled:e.disabled,placeholder:e.t("cluster.harvester.machinePool.sshUser.placeholder"),"tooltip-key":"cluster.harvester.machinePool.sshUser.toolTip"},model:{value:e.value.sshUser,callback:function(t){e.$set(e.value,"sshUser",t)},expression:"value.sshUser"}})],1)]),a("portal",{attrs:{to:"advanced-"+e.uuid}},[a("h3",{staticClass:"mt-20"},[e._v(" "+e._s(e.t("workload.container.titles.nodeScheduling"))+" ")]),a("NodeAffinity",{attrs:{mode:e.mode,value:e.vmAffinity.affinity.nodeAffinity},on:{input:e.updateNodeScheduling}}),a("h3",{staticClass:"mt-20"},[e._v(" "+e._s(e.t("cluster.credential.harvester.userData.title"))+" ")]),a("div",[e.isImportCluster&&e.isCreate?a("LabeledSelect",{staticClass:"mb-10",attrs:{options:e.userDataOptions,"label-key":"cluster.credential.harvester.userData.label",mode:e.mode,disabled:e.disabled},model:{value:e.userData,callback:function(t){e.userData=t},expression:"userData"}}):e._e(),a("YamlEditor",{key:e.userData,ref:"userDataYamlEditor",staticClass:"yaml-editor mb-20",attrs:{"editor-mode":"view"===e.mode?"VIEW_CODE":"EDIT_CODE",value:e.userData,disabled:e.disabled},on:{onInput:function(t){return e.valuesChanged(t,"userData")}}})],1),a("h3",[e._v(e._s(e.t("cluster.credential.harvester.networkData.title")))]),a("div",[e.isImportCluster&&e.isCreate?a("LabeledSelect",{staticClass:"mb-10",attrs:{options:e.networkDataOptions,"label-key":"cluster.credential.harvester.networkData.label",mode:e.mode,disabled:e.disabled},model:{value:e.networkData,callback:function(t){e.networkData=t},expression:"networkData"}}):e._e(),a("YamlEditor",{key:e.networkData,ref:"networkYamlEditor",staticClass:"yaml-editor mb-10",attrs:{"editor-mode":"view"===e.mode?"VIEW_CODE":"EDIT_CODE",value:e.networkData,disabled:e.disabled},on:{onInput:function(t){return e.valuesChanged(t,"networkData")}}})],1)],1)],1),e.errors.length?a("div",e._l(e.errors,(function(t,s){return a("div",{key:s},[a("Banner",{attrs:{color:"error",label:e.stringify(t.Message||t)}})],1)})),0):e._e()],1)},i=[],r=a("330a"),l=a.n(r),d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"row",on:{input:e.queueUpdate}},[a("div",{staticClass:"col span-12"},[a("ArrayListGrouped",{staticClass:"mt-20",attrs:{mode:e.mode,"default-add-value":{matchExpressions:[]},"add-label":e.t("workload.scheduling.affinity.addNodeSelector")},on:{remove:e.remove},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"row"},[a("div",{staticClass:"col span-6"},[a("LabeledSelect",{attrs:{options:e.affinityOptions,value:e.priorityDisplay(t.row.value),label:e.t("workload.scheduling.affinity.priority"),mode:e.mode},on:{input:function(a){e.changePriority(t.row.value)}}})],1)]),a("MatchExpressions",{key:e.rerenderNums,staticClass:"col span-12 mt-20",attrs:{mode:e.mode,type:e.node,"show-remove":!1},model:{value:t.row.value.matchExpressions,callback:function(a){e.$set(t.row.value,"matchExpressions",a)},expression:"props.row.value.matchExpressions"}})]}}]),model:{value:e.allSelectorTerms,callback:function(t){e.allSelectorTerms=t},expression:"allSelectorTerms"}})],1)])},n=[],o=a("44db"),c=a.n(o),u=a("da25"),h=a("9ce4"),m=a("e24b"),p=a("907c"),v=a("711b"),f=a("466b"),b=a("2cb5"),y=a("a0fb"),g={components:{ArrayListGrouped:y["a"],MatchExpressions:v["a"],LabeledSelect:f["a"]},props:{value:{type:Object,default:()=>({})},mode:{type:String,default:"create"}},data(){if(this.value.required)return{nodeSelectorTerms:this.value.required.nodeSelectorTerms};{const{preferredDuringSchedulingIgnoredDuringExecution:e=[],requiredDuringSchedulingIgnoredDuringExecution:t={}}=this.value,{nodeSelectorTerms:a=[]}=t,s=[...e,...a].map(e=>{const t=Object(m["clone"])(e);return t._id=Object(b["n"])(4),e.preference&&(Object.assign(t,e.preference),delete t.preference),t});return{allSelectorTerms:s,weightedNodeSelectorTerms:e,defaultWeight:1,rerenderNums:Object(b["n"])(4)}}},computed:{...Object(h["a"])({t:"i18n/t"}),isView(){return this.mode===u["u"]},hasWeighted(){return!!this.weightedNodeSelectorTerms},node(){return p["t"]},affinityOptions(){const e=[this.t("workload.scheduling.affinity.preferred"),this.t("workload.scheduling.affinity.required")];return e}},created(){this.queueUpdate=c()(this.update,500)},methods:{update(){const e={},t={nodeSelectorTerms:[]},a=[];this.allSelectorTerms.forEach(e=>{if(e.weight){const t={weight:1,preference:e};a.push(t)}else t.nodeSelectorTerms.push(e)}),a.length&&(e.preferredDuringSchedulingIgnoredDuringExecution=a),t.nodeSelectorTerms.length&&(e.requiredDuringSchedulingIgnoredDuringExecution=t),this.$emit("input",e)},remove(){this.rerenderNums=Object(b["n"])(4),this.queueUpdate()},changePriority(e){e.weight?this.$delete(e,"weight"):this.$set(e,"weight",1),this.update()},priorityDisplay(e){return e.weight?this.t("workload.scheduling.affinity.preferred"):this.t("workload.scheduling.affinity.required")},get:m["get"],isEmpty:m["isEmpty"]}},k=g,w=a("d802"),D=Object(w["a"])(k,d,n,!1,null,null,null),O=D.exports,C=a("15ca"),S=a("305c"),N=a("8e93"),x=a("4978"),I=a("870a"),$=a("6418"),E=a("0f81"),q=a("a8b9"),j=a("3c85"),A=a("3e9d"),_=a("4ac6");const T="storage-network.settings.harvesterhci.io";function L(){var e;function t(e,t=[]){const a=Array.isArray(Object(m["get"])(this,"status.conditions"))?this.status.conditions:t;return a.find(t=>t.type===e)}const a=t.call(this,"Initialized"),s=t.call(this,"Imported"),i=100===(null===(e=this.status)||void 0===e?void 0:e.progress);return![null===a||void 0===a?void 0:a.status,null===s||void 0===s?void 0:s.status].includes("False")&&(i&&!0)}var U={name:"ConfigComponentHarvester",components:{Loading:C["a"],LabeledSelect:f["a"],LabeledInput:N["a"],UnitInput:x["a"],Banner:$["a"],YamlEditor:I["b"],NodeAffinity:O},mixins:[S["a"]],props:{credentialId:{type:String,required:!0},uuid:{type:String,required:!0},disabled:{type:Boolean,default:!1},poolIndex:{type:Number,required:!0},machinePools:{type:Array,default:()=>[]}},async fetch(){this.errors=[];try{this.credential=await this.$store.dispatch("rancher/find",{type:p["u"].CLOUD_CREDENTIAL,id:this.credentialId});const i=Object(m["get"])(this.credential,"decodedData.clusterId"),r=`/k8s/clusters/${i}/v1`,d="imported"===this.credential.decodedData.clusterType;if(this.isImportCluster=d,i&&d){var e,t,a;const l=await Object(q["b"])({namespaces:this.$store.dispatch("cluster/request",{url:`${r}/${p["r"]}s`}),images:this.$store.dispatch("cluster/request",{url:`${r}/${p["j"].IMAGE}s`}),configMaps:this.$store.dispatch("cluster/request",{url:`${r}/${p["e"]}s`}),networks:this.$store.dispatch("cluster/request",{url:r+"/k8s.cni.cncf.io.network-attachment-definitions"})});for(const e of Object.keys(l)){const t=l[e];"rejected"!==t.status||this.errors.push(Object(A["d"])(t.reason))}if(this.errors.length>0){const e=await this.$store.dispatch("management/find",{type:p["o"].CLUSTER,id:i});e.stateDescription&&!e.isReady&&(this.errors=[e.stateDescription])}const d=[],n=[];((null===(e=l.configMaps.value)||void 0===e?void 0:e.data)||[]).map(e=>{var t,a;const s=null===(t=e.metadata)||void 0===t||null===(a=t.labels)||void 0===a?void 0:a[_["g"].CLOUD_INIT];"user"===s&&d.push({label:e.metadata.name,value:e.data.cloudInit}),"network"===s&&n.push({label:e.metadata.name,value:e.data.cloudInit})}),this.userDataOptions=d,this.networkDataOptions=n,this.images=null===(t=l.images.value)||void 0===t?void 0:t.data,this.networkOptions=((null===(a=l.networks.value)||void 0===a?void 0:a.data)||[]).filter(e=>{var t,a;return"true"!==(null===(t=e.metadata)||void 0===t||null===(a=t.annotations)||void 0===a?void 0:a[T])}).map(e=>{let t,a;try{const s=JSON.parse(e.spec.config),i=s.vlan;t=e.id,a=`${t} (vlanId=${i})`}catch(s){}return{label:a,value:t}}),(l.namespaces.value.data||[]).forEach(async e=>{const t=await this.$store.dispatch("cluster/create",e);if(!t.isSystem&&e.links.update){const t=e.metadata.name,a=e.metadata.name;this.namespaces.push(e),this.namespaceOptions.push({label:a,value:t})}});try{const{data:e}=await this.$store.dispatch("cluster/request",{url:`${r}/${p["t"]}s`});this.allNodeObjects=e}catch(s){this.allNodeObjects=[]}}l()(this.value.cpuCount)&&(this.value.cpuCount="2"),l()(this.value.memorySize)&&(this.value.memorySize="4"),l()(this.value.diskSize)&&(this.value.diskSize="40")}catch(i){this.errors=Object(A["c"])(i)}},data(){let e={affinity:{}},t="",a="";return this.value.vmAffinity&&(e={affinity:JSON.parse(Object(E["a"])(this.value.vmAffinity))}),this.value.userData&&(t=Object(E["a"])(this.value.userData)),this.value.networkData&&(a=Object(E["a"])(this.value.networkData)),{credential:null,isImportCluster:!1,vmAffinity:e,userData:t,networkData:a,images:[],namespaces:[],namespaceOptions:[],networkOptions:[],userDataOptions:[],networkDataOptions:[],allNodeObjects:[],cpuCount:""}},computed:{...Object(h["a"])({t:"i18n/t"}),disabledEdit(){return this.disabled||!(!this.isEdit||!this.value.id)},imageOptions:{get(){return(this.images||[]).filter(e=>!e.spec.url.endsWith(".iso")&&L.call(e)).sort((e,t)=>e.metadata.creationTimestamp>t.metadata.creationTimestamp?-1:1).map(e=>{const t=e.id,a=`${e.spec.displayName} (${t})`;return{label:a,value:t}})},set(e){this.images=e}},namespaceDisabled(){return this.disabledEdit||this.poolIndex>0}},watch:{credentialId(){this.isEdit||(this.imageOptions=[],this.networkOptions=[],this.namespaces=[],this.namespaceOptions=[],this.vmAffinity={affinity:{}},this.value.imageName="",this.value.networkName="",this.value.vmNamespace="",this.value.vmAffinity=""),this.$fetch()},networkData(e){this.$refs.networkYamlEditor.refresh(),this.value.networkData=Object(E["b"])(e)},userData(e){this.$refs.userDataYamlEditor.refresh(),this.value.userData=Object(E["b"])(e)},machinePools:{handler(e){const t=e[0].config.vmNamespace;this.poolIndex>0&&this.value.vmNamespace!==t&&(this.value.vmNamespace=t)},deep:!0}},methods:{stringify:A["d"],test(){const e=[];if(!this.value.cpuCount){const t=this.validatorRequiredField(this.t("cluster.credential.harvester.cpu"));e.push(t)}if(!this.value.vmNamespace){const t=this.validatorRequiredField(this.t("cluster.credential.harvester.namespace"));e.push(t)}if(!this.value.memorySize){const t=this.validatorRequiredField(this.t("cluster.credential.harvester.memory"));e.push(t)}if(!this.value.diskSize){const t=this.validatorRequiredField(this.t("cluster.credential.harvester.disk"));e.push(t)}if(!this.value.imageName){const t=this.validatorRequiredField(this.t("cluster.credential.harvester.image"));e.push(t)}if(!this.value.sshUser){const t=this.validatorRequiredField(this.t("cluster.credential.harvester.sshUser"));e.push(t)}if(!this.value.networkName){const t=this.validatorRequiredField(this.t("cluster.credential.harvester.network"));e.push(t)}return Object(j["a"])(this.vmAffinity.affinity,this.$store.getters,e),{errors:e}},validatorRequiredField(e){return this.t("validation.required",{key:e})},valuesChanged(e,t){this.value[t]=Object(E["b"])(e)},onOpen(){this.getVmImage()},async getVmImage(){try{const e=Object(m["get"])(this.credential,"decodedData.clusterId"),t=`/k8s/clusters/${e}/v1`;if(t&&this.isImportCluster){const e=await this.$store.dispatch("cluster/request",{url:`${t}/${p["j"].IMAGE}s`});this.images=null===e||void 0===e?void 0:e.data}}catch(e){this.errors=Object(A["c"])(e)}},updateScheduling(e){const{affinity:t}=e;if(!t.nodeAffinity&&!t.podAffinity&&!t.podAntiAffinity)return this.value.vmAffinity="",void(this.vmAffinity={affinity:{}});this.value.vmAffinity=Object(E["b"])(JSON.stringify(t)),this.vmAffinity=e},updateNodeScheduling(e){this.vmAffinity.affinity?Object.assign(this.vmAffinity.affinity,{nodeAffinity:e}):Object.assign(this.vmAffinity,{affinity:{nodeAffinity:e}}),this.updateScheduling(this.vmAffinity)}}},z=U,P=(a("a812"),Object(w["a"])(z,s,i,!1,null,"3d113ddb",null));t["default"]=P.exports}}]);
//# sourceMappingURL=elemental-1.0.0.umd.min.vendors~machine-config8.js.map